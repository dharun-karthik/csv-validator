stages:
  - dependencies
  - test

install-node-dependencies:
  image: node:latest
  stage: dependencies
  cache:
    key: node-modules
    paths:
      - node_modules/
      - .npm/
      - cache/Cypress
    policy: pull-push
  script:
    - npm install


unit-test:
  image: gradle:latest
  stage: test
  script:
    - echo "Test Started"
    - gradle test
    - echo "Test Passed"

front-end-unit-test:
  image: node:latest
  stage: test
  cache:
    key: node-modules
    paths:
      - node_modules/
    policy: pull
  script:
    - echo "Front end unit test Started"
    - npm install
    - npm test
    - echo "Front end unit test Passed"

integration-test:
  image: cypress/browsers:node12.14.1-chrome85-ff81
  stage: test
  cache:
    key: node-modules
    paths:
      - node_modules/
      - .npm/
      - cache/Cypress
  script:
    - echo "Integeration test Started"
    - apt-get --allow-releaseinfo-change update
    - apt-get install -y default-jdk
    - ./gradlew build
    - ./gradlew run &
    - echo "Server is running"
    - npm install
    - npm run e2e
    - echo "Integeration test Passed"
